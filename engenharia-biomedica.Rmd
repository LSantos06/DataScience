---
title:  Ciência de Dados para Todos (Data Science
  For All) - 2018.2 - Análise da Produção Científica e Acadêmica da Universidade de Brasília - Engenharia Biomédica
author: "Marcos Vinicius Prescendo Tonin, Lucas Nascimento, Carlos Aragão"
date: "20/09/2018"
output:
  pdf_document: 
    latex_engine: xelatex
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = getwd())
```

# Introdução

O presente trabalho tem por finalidade entender e correlacionar dados que possam algum significado mais profundo do que aparentam ter, assim com os dados da pós-graduação em engenharia biomédica em mãos busca-se encontrar principais fatores, professores mais envolvidos, temas mais relevantes e afins.

#Metodologia

Para um melhor resultado do trabalho buscou-se seguir e adaptar-se a metodologia CRISP-DM, para isso baseou-se no ciclo de projeto usado pelo CRISP-DM.

O ciclo é basicamente definido pelas seguintes fases:

* **Entendimento do negócio** : primeiramente deve-se entender o que se busca encontrar, haja visto que não faz sentido fazer uma análise de dados sem saber o que se busca.

* **Entendimento dos dados** : Busca-se entender os dados de forma mais superficial primeiramente.

* **Preparação de dados ** : Então limpa-se o dado e prepara o dado para que se possa facilitar seu processamento.

* **Modelagem ** : Faz a modelagem do dado.
* **Avaliação ** : Avalia-se o resultado da modelagem.
* **Implantação ** : Faz uso dos dados.

As fases não são independentes entre si, mas possuem certa comunicação, depedendo das fases, além de não ser estritamente sequencial, sendo melhor visualizado na figura abaixo.

![Ciclo do CRISP-DM que será usado como base](dados-2018-2/engenharia-biomedica/fluxo.png)

Por esta imagem consegue-se perceber que o entendimento do negócio e do dado pode muitas vezes ser alternada, indo e voltando.

## Delimitações iniciais


###Domínio de Aplicação do projeto
O domínio de aplicação do projeto é  produção científica ou produção acadêmica de um subgrupo de pesquisadores vinculados à Universidade de Brasília, sendo vinculado ao subtema __engenharia biomédica__, tais arquivos foram pegos na plataforma elattes.

###Problema abordado

Problema abordado tem por finalidade obter dados de forma descritiva, quantitativa e de modelagem computacional ou estatástica, que permitam caracterizar como, porque e também para que ocorre a produção científica e acadêmica na Área de engenharia biomédica.

# CRISP-DM Fase 1 - Entendimento do Negócio

A Universidade de Brasília é uma das grandes universidades federais, sendo responsável pela produção de artigos visando artigos acadêmicos, este presente trabalho de como programas :

## Programas de Pós-Graduação Grupo 15
| Ids           | Área de Avaliação | Nome do Programa                                  | Link Capes                                                        | ME | DO | MP |
|---------------|------------------:|---------------------------------------------------|-------------------------------------------------------------------|----|----|----|
| 53001010059P8 |    ENGENHARIAS IV | ENGENHARIA ELÉTRICA                               | [ENGENHARIA ELÉTRICA (53001010059P8)](https://sucupira.capes.gov.br/sucupira/public/consultas/coleta/programa/viewPrograma.jsf?popup=true&&cd_programa=53001010059P8)                               | -  | -  | 3  |
| 53001010080P7 |    ENGENHARIAS IV | ENGENHARIA ELÉTRICA                               | [ENGENHARIA ELÉTRICA (53001010080P7)](https://sucupira.capes.gov.br/sucupira/public/consultas/coleta/programa/viewPrograma.jsf?popup=true&&cd_programa=53001010080P7)                               | 4  | 4  | -  |
| 53001010081P3 |    ENGENHARIAS IV | ENGENHARIA DE SISTEMAS ELETRÔNICOS E DE AUTOMAÇÃO | [ENGENHARIA DE SISTEMAS ELETRÔNICOS E DE AUTOMAÇÃO (53001010081P3)](https://sucupira.capes.gov.br/sucupira/public/consultas/coleta/programa/viewPrograma.jsf?popup=true&&cd_programa=53001010081P3) | 4  | 4  | -  |
| 53001010083P6 |    ENGENHARIAS IV | ENGENHARIA BIOMÉDICA                              | [ENGENHARIA BIOMÉDICA (53001010083P6)](https://sucupira.capes.gov.br/sucupira/public/consultas/coleta/programa/viewPrograma.jsf?popup=true&&cd_programa=53001010083P6)                              | 3  | -  | -  |

Sendo o enfoque principal os dados referente a engenharia biomédica, que por sua vez tem sua pesquisa muitas voltada a novas soluções na área de biomédica.

##Avaliação das Circunstancias

Este trabalho terá o limite que os próprios dados gerado pela plataforma elattes tem, já que se os dados fornecidos delimitariam o escopo do projeto e até pode-se ir, ou melhor, até onde os dados permitem uma análise fidedgina. 

#CRISP-DM Fase 2 - Entendimento dos Dados

##CRISP-DM Fase.Atividade 2.1 - Coleta inicial dos dados

Todos os arquivos com dados iniciais a seguir apresentados foram fornecidos pelos professores responsáveis pela disciplina, através da plataforma elattes. Os dados foram gerados no mês de setembro de 2018, data em que o presente grupo começou a realizar o trabalho e compilam informações entre os anos de 2010 e 2017, das áreas expostas na seção anterior. 
Os arquivos estão no formato JSON, sendo todos fornecidos pelos docentes responsável por esta disciplina.

###Perfil profissional dos docentes vinculados às pós-graduações

```{r}
json.perfil.biomed <- "dados-2018-2/engenharia-biomedica/279.profile.json"
file.info(json.perfil.biomed)
```

O arquivo `r json.perfil.biomed` apresenta dados sobre o perfil de todos os docentes vinculados a programas de pós-graduação, em engenharia biomédia, da UnB, entre 2010 e 2017. 


###Orientações de mestrado e doutorado realizadas pelos docentes vinculados às pós-graduações

```{r}
json.advise.biomed <- "dados-2018-2/engenharia-biomedica/279.advise.json"
file.info(json.advise.biomed)
```

O arquivo `r json.advise.biomed` apresenta dados sobre o orientações de mestrado e doutorado feitas por todos os docentes vinculados a programas de pós-graduação em engenharia biomédica, da UnB, entre 2010 e 2017. 


###Produção bibliográfica gerada pelos docentes vinculados Ã s pós-graduações

```{r}
json.producao.bibliografica.biomed <- "dados-2018-2/engenharia-biomedica/279.publication.json"
file.info(json.producao.bibliografica.biomed) 
```

O arquivo `r json.producao.bibliografica.biomed` apresenta dados sobre a produção bibliográfica gerada por todos os docentes vinculados a programas de pós-graduação, em engenharia biomédica, da UnB, entre 2010 e 2017. 

###ID's dos docentes participantes e o que contêm o arquivo list.json

```{r}
json.list.biomed <- "dados-2018-2/engenharia-biomedica/279.list.json"
file.info(json.list.biomed) 
```

O arquivo `r json.list.biomed` apresenta o id de todos docentes vinculados a programas de pós-graduação, em engenharia biomédica, da UnB, entre 2010 e 2017.Porém tal arquivo se mostra inútil, haja visto que só contém o id e que as outras variáveis como __"nome"__ sempre tem seu valor igual a __""__. 




###Redes de colaboração entre docentes

```{r}
json.graph.biomed<-'dados-2018-2/engenharia-biomedica/279.graph.json'
file.info(json.graph.biomed)
```

O arquivo `r json.graph.biomed` apresenta redes de colaboração na co-autoria de artigos científicos, feitas entre os docentes vinculados a programas de pós-graduação da UnB, entre 2010 e 2017.

##CRISP-DM Fase.Atividade 2.2 - Descrição dos Dados

Para ler e manipular inicialmente esses dados, serão usadas primordialmente as bibliotecas seguintes 

```{r library-load}
library(jsonlite)
library(listviewer)
library(readxl)
library(readr)
library(readtext)
library(ggplot2)
library(tidyverse)
library(stringr)
```

Com estas bibliotecas seremos capazes de responder e determinar qual o volume de dados, a estrutura dos dados (tipos), codificações usadas, etc..

###Descrição dos dados do perfil

```{r}
unb.prof.biomed <- fromJSON("dados-2018-2/engenharia-biomedica/279.profile.json")
```

A quantidade de docentes sob análise é apresentada a seguir.
```{r}
length(unb.prof.biomed)
```

Para um melhor entendimento é importante saber como os dados estão dispostos para algum número de ocorrência.

```{r}
### Usando glimpse
glimpse(unb.prof.biomed[[1]], width = 30)
```

Podemos inferir que:

* Que o professor não é da área da engenharia elétrica, por formação, mas acabou por aderir a subárea engenharia biomédica.
* Não é nativo da UnB, sendo formado no UFG.
* Atualmente trabalha na UnB do Gama.
* Sua senioridade é de 9.

####Potencial de utilização dos dados do perfil dos docentes

###Descrição dos dados de orientações

```{r}
unb.adv.biomed <- fromJSON("dados-2018-2/engenharia-biomedica/279.advise.json")
# Mostrando as listas presentes neste arquivo.
names(unb.adv.biomed)
# Explorando um nível de detalhe de Orientações de doutorados concluídas
names(unb.adv.biomed$ORIENTACAO_CONCLUIDA_DOUTORADO)
############## DOUTORADO 2017
#Buscando cursos que mais produziram doutorados.
head(sort(table(unb.adv.biomed$ORIENTACAO_CONCLUIDA_DOUTORADO$`2017`$curso), decreasing = TRUE), 10)
#Sabendo suas instituições
head(sort(table(unb.adv.biomed$ORIENTACAO_CONCLUIDA_DOUTORADO$`2017`$instituicao), decreasing = TRUE), 10)
#Sabendo seus orientadores
data_orienM <- capture.output(str(unb.adv.biomed$ORIENTACAO_CONCLUIDA_DOUTORADO$`2017`$nome_orientadores))
unique(data_orienM)
############## MESTRADO 2017
#Buscando cursos que mais produziram mestrados.
head(sort(table(unb.adv.biomed$ORIENTACAO_CONCLUIDA_MESTRADO$`2017`$curso), decreasing = TRUE), 10)
head(sort(table(unb.adv.biomed$ORIENTACAO_CONCLUIDA_MESTRADO$`2017`$instituicao), decreasing = TRUE), 10)
#Sabendo suas instituições
head(sort(table(unb.adv.biomed$ORIENTACAO_CONCLUIDA_MESTRADO$`2017`$instituicao), decreasing = TRUE), 10)
#Sabendo seus orientadores
data_orien <- capture.output(str(unb.adv.biomed$ORIENTACAO_CONCLUIDA_MESTRADO$`2017`$nome_orientadores))
unique(data_orien)
```

Como se pode perceber apenas u, professor que orientou doutorado concluido em 2017 ( "Marilia Miranda Forte Gomes") também fez parte dos professores que orientaram no mestrado: 

* "Georges Daniel Amvame Nze"
* "Jose Felicio da Silva"
* "Lourdes Mattos Brasil"
* "Marcelino Monteiro de Andrade"
* "Marilia Miranda Forte Gomes"
* "Ronni Geraldo Gomes de Amorim"

Sendo o professor "Marcus Vinícius Chaffim Costa" responsável apenas por orientações de doutorado em 2017.

###Descrição dos dados list.json

```{r}
unb.list.biomed <- fromJSON("dados-2018-2/engenharia-biomedica/279.list.json")
#analisando a quantidade de elementos presente em list.json
length(unb.list.biomed$fiocruz$id)
# Mostrando alguns id, verificar que eles são diferentes       
d_listID <- unb.list.biomed$fiocruz$id
unique(d_listID)
#Mostrando nome sempre igual ""
d_listNO <- unb.list.biomed$fiocruz$nome
unique(d_listNO)
#Mostrando periodo sempre igual 2010-2017 
d_listDT <- unb.list.biomed$fiocruz$periodo
unique(d_listDT)


```

Feito a análise, percebe-se que apenas o campo id que muda, tanto __"nome"__ (obtendo sempre o valor "") e __"periodo"__(obtendo sempre o valor["2010","2017"]), por isso considera-se este arquivo JSON como inútil, haja visto que não dá para obter quaisquer dado plaúsivel, somente os id.



###Descrição dos dados de produção bibliográfica
```{r}
unb.pub.biomed <- fromJSON("dados-2018-2/engenharia-biomedica/279.publication.json")
# Verificando os tipos de produções que existe.
names(unb.pub.biomed)
#Analisando o qual tipo de informação se tem em periódicos no ano 2012.
names(unb.pub.biomed$PERIODICO$`2012`)
#Nomes dos periódicos em que tiveram mais publicações na área de engenharia biomédica.
head(sort(table(unb.pub.biomed$PERIODICO$`2017`$periodico), decreasing = TRUE), 10)
#Nomes dos periódicos em que tiveram mais publicações de artigos aceitos na área de engenharia biomédica da UnB no 2017.
head(sort(table(unb.pub.biomed$ARTIGO_ACEITO$`2017`$periodico), decreasing = TRUE), 10)
#Nomes dos autores que produziram um tipo de produção que não estava contemplada .
head(sort(table(unb.pub.biomed$DEMAIS_TIPOS_DE_PRODUCAO_BIBLIOGRAFICA$`2011`$autores), decreasing = TRUE), 10)

```


###Descrição dos dados de redes de colaboração

```{r}
unb.graph.biomed <- fromJSON("dados-2018-2/engenharia-biomedica/279.graph.json")
# Suas variáveis
names(unb.graph.biomed)
# Quantidade de nós
length(unb.graph.biomed$nodes$id)
# Quantidade de links de fonte 
length(unb.graph.biomed$links$source)
# Quantidade de links de chegada 
length(unb.graph.biomed$links$target)
#exemplos de pesos da aresta
str(unb.graph.biomed$links$weigth)
```


##CRISP-DM Fase.Atividade 2.3 - Análise exploratória dos dados

###Arquivo Profile

```{r}
# Total de áreas de atuação de todos profissionais
sum(sapply(unb.prof.biomed, function(x) nrow(x$areas_de_atuacao)))
# Número de pessoas por grande area
table(unlist(sapply(unb.prof.biomed, function(x) (x$areas_de_atuacao$grande_area))))
# Número de pessoas que produziram os tipos de produção específico
table(unlist(sapply(unb.prof.biomed, function(x) names(x$producao_bibiografica))))
# Número de publicações por tipo
#####ARTIGO ACEITO###############
sum(sapply(unb.prof.biomed, function(x) length(x$producao_bibiografica$ARTIGO_ACEITO$ano)))
# Número de pessoas por quantitativo de produções por pessoa 0 = 1; 1 = 2...
table(unlist(sapply(unb.prof.biomed, function(x) length(x$producao_bibiografica$ARTIGO_ACEITO$ano))))

#####CAPITULO DE LIVRO###############
sum(sapply(unb.prof.biomed, function(x) length(x$producao_bibiografica$CAPITULO_DE_LIVRO$ano)))
# Número de pessoas por quantitativo de produções por pessoa 0 = 1; 1 = 2...
table(unlist(sapply(unb.prof.biomed, function(x) length(x$producao_bibiografica$CAPITULO_DE_LIVRO$ano))))

#####LIVRO###############
sum(sapply(unb.prof.biomed, function(x) length(x$producao_bibiografica$LIVRO$ano)))
# Número de pessoas por quantitativo de produções por pessoa 0 = 1; 1 = 2...
table(unlist(sapply(unb.prof.biomed, function(x) length(x$producao_bibiografica$LIVRO$ano))))

#####PERIÓDICO###############
sum(sapply(unb.prof.biomed, function(x) length(x$producao_bibiografica$PERIODICO$ano)))
# Número de pessoas por quantitativo de produções por pessoa 0 = 1; 1 = 2...
table(unlist(sapply(unb.prof.biomed, function(x) length(x$producao_bibiografica$PERIODICO$ano))))

#####TEXTO EM JORNAIS###############
sum(sapply(unb.prof.biomed, function(x) length(x$producao_bibiografica$TEXTO_EM_JORNAIS$ano)))
# Número de pessoas por quantitativo de produções por pessoa 0 = 1; 1 = 2...
table(unlist(sapply(unb.prof.biomed, function(x) length(x$producao_bibiografica$TEXTO_EM_JORNAIS$ano))))

#####DEMAIS TIPOS###############
sum(sapply(unb.prof.biomed, function(x) length(x$producao_bibiografica$DEMAIS_TIPOS_DE_PRODUCAO_BIBLIOGRAFICA$ano)))
# Número de pessoas por quantitativo de produções por pessoa 0 = 1; 1 = 2...
table(unlist(sapply(unb.prof.biomed, function(x) length(x$producao_bibiografica$DEMAIS_TIPOS_DE_PRODUCAO$ano))))



# Número de produções por ano
table(unlist(sapply(unb.prof.biomed, function(x) (x$producao_bibiografica$ARTIGO_ACEITO$ano))))
table(unlist(sapply(unb.prof.biomed, function(x) (x$producao_bibiografica$CAPITULO_DE_LIVRO$ano))))
table(unlist(sapply(unb.prof.biomed, function(x) (x$producao_bibiografica$LIVRO$ano))))
table(unlist(sapply(unb.prof.biomed, function(x) (x$producao_bibiografica$PERIODICO$ano))))
table(unlist(sapply(unb.prof.biomed, function(x) (x$producao_bibiografica$TEXTO_EM_JORNAIS$ano))))
# Número de pessoas que realizaram diferentes tipos de orientações
length(unlist(sapply(unb.prof.biomed, function(x) names(x$orientacoes_academicas))))
# Número de pessoas por tipo de orientação
table(unlist(sapply(unb.prof.biomed, function(x) names(x$orientacoes_academicas))))
#Número de orientações concluidas
sum(sapply(unb.prof.biomed, function(x) length(x$orientacoes_academicas$ORIENTACAO_CONCLUIDA_MESTRADO$ano)))
sum(sapply(unb.prof.biomed, function(x) length(x$orientacoes_academicas$ORIENTACAO_CONCLUIDA_DOUTORADO$ano)))
sum(sapply(unb.prof.biomed, function(x) length(x$orientacoes_academicas$ORIENTACAO_CONCLUIDA_POS_DOUTORADO$ano)))

# Número de pessoas por quantitativo de orientações por pessoa 0 = 1; 1 = 2...
table(unlist(sapply(unb.prof.biomed, function(x) length(x$orientacoes_academicas$ORIENTACAO_CONCLUIDA_MESTRADO$ano))))
table(unlist(sapply(unb.prof.biomed, function(x) length(x$orientacoes_academicas$ORIENTACAO_CONCLUIDA_DOUTORADO$ano))))
table(unlist(sapply(unb.prof.biomed, function(x) length(x$orientacoes_academicas$ORIENTACAO_CONCLUIDA_POS_DOUTORADO$ano))))

# Número de orientações por ano
table(unlist(sapply(unb.prof.biomed, function(x) (x$orientacoes_academicas$ORIENTACAO_CONCLUIDA_MESTRADO$ano))))
table(unlist(sapply(unb.prof.biomed, function(x) (x$orientacoes_academicas$ORIENTACAO_CONCLUIDA_DOUTORADO$ano))))
table(unlist(sapply(unb.prof.biomed, function(x) (x$orientacoes_academicas$ORIENTACAO_CONCLUIDA_POS_DOUTORADO$ano))))

```

###Arquivo Publicação
```{r}

#Criando um data-frame com todos os anos
unb.pub.biomed.df <- data.frame()
for (i in 1:length(unb.pub.biomed[[1]]))
  unb.pub.biomed.df <- rbind(unb.pub.biomed.df, unb.pub.biomed$PERIODICO[[i]])
glimpse(unb.pub.biomed.df)
# Limpando o data-frame de listas
unb.pub.biomed.df$autores <- gsub("\",\"|\", \"", "; ", unb.pub.biomed.df$autores)
unb.pub.biomed.df$autores <- gsub("\"|c\\(|\\)", "", unb.pub.biomed.df$autores)
unb.pub.biomed.df$`autores-endogeno` <- gsub(",", ";", unb.pub.biomed.df$`autores-endogeno`)
unb.pub.biomed.df$`autores-endogeno` <- gsub("\"|c\\(|\\)", "", unb.pub.biomed.df$`autores-endogeno`)
glimpse(unb.pub.biomed.df)


### ARQUIVO PROCESSADO E LIMPO 
## Publicações por natureza - todas foram completas
table(unb.pub.biomed.df$natureza)

## Publicações 2010 até 2017
table(unb.pub.biomed.df$ano)
## Publicações por periódico, mostrando os top-5 na área de biomédica
d <- table(unb.pub.biomed.df$periodico)
head(sort(d,decreasing = TRUE),n=5)

## Mostrando os autores que tiveram mais publicação
### Neste caso é importante mostra que como a não uniformidade de como se escreve acaba por tornar este dado defasado
head(sort(table(toupper(unlist(strsplit(unb.pub.biomed.df$autores,";")))),decreasing = TRUE),n=10)
## Mostrando os autores-endogeno que tiveram mais publicação
head(sort(table(unlist(unb.pub.biomed.df$`autores-endogeno`)),decreasing = TRUE),n=10)
```


###Arquivo Orientação
```{r}
#Orientação
#Visualizar a estrutura do json no painel Viewer
#jsonedit(unb.adv.biomed)
#Reunir todos os anos e orientações concluidas em um mesmo data-frame
unb.adv.biomed.tipo.df <- data.frame(); unb.adv.biomed.df <- data.frame()
for (i in 1:length(unb.adv.biomed[[1]]))
  unb.adv.biomed.tipo.df <- rbind(unb.adv.biomed.tipo.df, unb.adv.biomed$ORIENTACAO_CONCLUIDA_POS_DOUTORADO[[i]])
unb.adv.biomed.df <- rbind(unb.adv.biomed.df, unb.adv.biomed.tipo.df); unb.adv.biomed.tipo.df <- data.frame()
for (i in 1:length(unb.adv.biomed[[1]]))
  unb.adv.biomed.tipo.df <- rbind(unb.adv.biomed.tipo.df, unb.adv.biomed$ORIENTACAO_CONCLUIDA_DOUTORADO[[i]])
unb.adv.biomed.df <- rbind(unb.adv.biomed.df, unb.adv.biomed.tipo.df); unb.adv.biomed.tipo.df <- data.frame()
for (i in 1:length(unb.adv.biomed[[1]]))
  unb.adv.biomed.tipo.df <- rbind(unb.adv.biomed.tipo.df, unb.adv.biomed$ORIENTACAO_CONCLUIDA_MESTRADO[[i]])
unb.adv.biomed.df <- rbind(unb.adv.biomed.df, unb.adv.biomed.tipo.df)
glimpse(unb.adv.biomed.df)
#Transformar as colunas de listas em caracteres eliminando c("")
unb.adv.biomed.df$nome_orientadores <- gsub("\"|c\\(|\\)", "", unb.adv.biomed.df$nome_orientadores)
unb.adv.biomed.df$id_lattes_orientadores <- gsub("\"|c\\(|\\)", "", unb.adv.biomed.df$id_lattes_orientadores)
#Separar as colunas com dois orientadores
unb.adv.biomed.df <- separate(unb.adv.biomed.df, nome_orientadores, into = c("ori1", "ori2"), sep = ",")
# Contando quem tem apenas 1 orientador
sum(is.na(unb.adv.biomed.df$ori2))
unb.adv.biomed.df <- separate(unb.adv.biomed.df, id_lattes_orientadores, into = c("idLattes1", "idLattes2"), sep = ",")
# Contando quem tem apenas 1 orientador
sum(is.na(unb.adv.biomed.df$idLattes2))
#Numero de orientacoes por ano
table(unb.adv.biomed.df$ano)
#Numero de instituições 
sort(table(unb.adv.biomed.df$instituicao),decreasing = TRUE)
#Cursos que estão envolvido na pós-graduação de engenharia biomédica
cursos_d <- sort(table(unb.adv.biomed.df$curso), decreasing = TRUE)
cursos_d
cursos_d5<-head(cursos_d,5)
table(unb.adv.biomed.df$codigo_do_curso)
#Quantidas de natureza dos trabalhos orientado
table(unb.adv.biomed.df$natureza)
#Tabela com nome de professor e numero de orientacoes
head(sort(table(rbind(unb.adv.biomed.df$ori1, unb.adv.biomed.df$ori2)), decreasing = TRUE), 20)
# Tabela com nome dos alunos que mais foram orientados
head(sort(table(toupper(unb.adv.biomed.df$nome_aluno)),decreasing = TRUE),n=10)
# Quantidade de alunos que não são bolsistas 
sum(unb.adv.biomed.df$bolsa == 'NAO')
# Quantidade de alunos que são bolsistas 
sum(unb.adv.biomed.df$bolsa == 'SIM')
# Reparar que a maioria não tem agência financiadora por trás e há dois alunos que tem bolsa mas que não tem/declararam agência financiadora.
table(unb.adv.biomed.df$agencia_financiadora)
```


##CRISP-DM Fase.Atividade 2.4 - Verificação da qualidade dos dados. 

Para o levantamento de informação os dados em geral são preciso, como por exemplo saber quais os professores mais envolvido em orientações, quantos artigos foram concluidos, informações por ano. Mas houve dificuldade quando o dado que se queria analisar dependia de como a pessoa que cadastrou escreveu, como por exemplo os autores nos artigos, haja visto que não foi encontrado um padrão, dificultou qualquer análise. 

#CRISP-DM Fase 3 -  __Preparação dos Dados__


##CRISP-DM Fase.Atividade 3.1 - Seleção dos dados. 

Para a principal utilização dos dados foi definidos os __data frames__ unb.adv.biomed.df, que neste caso contêm alguns informações de qual a natureza da pesquisa produzida, qual aluno produziu, seus respectivos orientadores, o ano e etc. Também foi definido os dados importantes do arquivo profile.json, gerando o __data frame__ unb.prof.biomed.df, que já está limpo, com as principais colunas definidas.

##CRISP-DM Fase.Atividade 3.2 - Limpeza dos dados

Esta etapa se mistura com a próxima pelo fato de limpar e preparar o dado, ou seja, já construir.

##CRISP-DM Fase.Atividade 3.3 - Construção dos dados

Construindo e limpando alguns dados de interesse.
```{r}
# Funcoes auxiliares que serão usados
# estas funções foram disponibilizada pelo professor da disciplina
# converte as colunas de um dataframe tipo lista em tipo character
cv_tplista2tpchar <- function( df  ) { 
  for( variavel in names(df)) {
    if (class(df[[variavel]]) == "list" ) {
      df[[variavel]] <- lapply(df[[variavel]] ,   function(x)   lista2texto( x  ) ) 
      df[[variavel]] <- as.character( df[[variavel]] )
    }
  }
  return(df)
}
###


# converte o conteudo de lista em array de characters
lista2texto <- function( lista  ) {
  if(is.null(lista)) {
    return ( NULL )
  }
  saida <- ""
  for( j in 1:length(lista)) { 
    for( i in 1:length(lista[[j]]) ) {
      elemento <- lista[[j]][i] 
      if( !is.null(elemento)) { 
        if( i == length(lista[[j]]) & j == length(lista)  ) { 
          # se for o ultimo elemento nao coloque o ponto e virgula no final            
          saida <- paste0( saida , elemento  )
        } else {
          # enquanto nao for o ultimo coloque ; separando os elementos concatenados 
          saida <- paste0( saida , elemento , sep = " ; ")
        }
      }  
    }
  }
  return( saida )
}

# Converte producao elattes separada por anos em um unico dataframe 
converte_producao2dataframe<- function( lista_producao ) {
  df_saida <- NULL 
  
  for( ano in names(lista_producao)) {
    df_saida <- rbind(df_saida , lista_producao[[ano]])
  }
  
  # converte tipo lista em array de character 
  df_saida <- cv_tplista2tpchar(df_saida)
  return(df_saida)
  

}

#concatena dois dataframes com  colunas diferentes 
concatenadf <- function( df1, df2) { 
  #cria colunas de df1 que faltam em df2
  for( coluna in names(df1 ) ) {
    if( !is.element(coluna, names(df2) )) {
      df2[coluna] <- NA
    }
  }
  
  #cria colunas de df2 que faltam em df1  
  for( coluna in names(df2 ) ) {
    
    if( !is.element(coluna, names(df1) )) {
      df1[coluna] <- NA
    }
  }
  
  
  #faz o rbind dos dois dataframes 
  df_final <- rbind(df1 , df2)
  return(df_final)
  
}

# Extracao dos perfis dos professores 

extrai_1perfil <- function( professor ) {
  idLattes <- names(professor)
  nome <- professor[[idLattes]]$nome   
  resumo_cv <- professor[[idLattes]]$resumo_cv 
  endereco_profissional <- professor[[idLattes]]$endereco_profissional #list 
  instituicao <- endereco_profissional$instituicao
  orgao <- endereco_profissional$orgao
  unidade <- endereco_profissional$unidade
  DDD <- endereco_profissional$DDD
  telefone <- endereco_profissional$telefone
  bairro <- endereco_profissional$bairro
  cep <- endereco_profissional$cep
  cidade <- endereco_profissional$cidade
  senioridade <- professor[[idLattes]]$senioridade  
  df_1perfil <- data.frame( idLattes , nome, resumo_cv ,instituicao , 
                           orgao, unidade , DDD, telefone, bairro,cep,cidade , senioridade,
                           stringsAsFactors = FALSE)
  
  return(df_1perfil)  
}

extrai_perfis <- function(jsonProfessores) {
  df_saida <- data.frame()
  for( i in 1:length(jsonProfessores)) {
    jsonProfessor <- jsonProfessores[i]
    df_professor <- extrai_1perfil(jsonProfessor)
    if( nrow(df_saida) > 0 ) {
      df_saida <- rbind(df_saida , df_professor)
    } else {
      df_saida <- df_professor 
    }
  }
   
  return(df_saida)
}

# Extracao da producao bibliografica dos professores 

extrai_1producao <- function(professor) {
  idLattes <- names(professor)
  df_1producao <<- NULL 
  producao_bibliografica <- professor[[idLattes]]$producao_bibiografica  #list
  for( tipo_producao in names(producao_bibliografica)) { 
    df_temporario <- cv_tplista2tpchar ( producao_bibliografica[[tipo_producao]]) 
    df_temporario$tipo_producao <-  tipo_producao 
    df_temporario$idLattes <-  idLattes
    df_1producao <- concatenadf( df_1producao , df_temporario  )
  }  
  return(df_1producao)
}

extrai_producoes <- function( jsonProfessores) {
  df_saida <- data.frame()
  for( i in 1:length(jsonProfessores)) {
    jsonProfessor <- jsonProfessores[i]
    df_producao <- extrai_1producao(jsonProfessor)
    if( nrow(df_saida) > 0 ) {
      df_saida <- concatenadf(df_saida , df_producao)
    } else {
      df_saida <- df_producao 
    }
  }
  df_saida <- df_saida %>% filter( !is.na(tipo_producao))
  return(df_saida)  
}

# Extracao das orientacoes dos professores 

extrai_1orientacao <- function(professor) {
  idLattes <- names(professor)
  df_1orientacao <- NULL
  orientacoes_academicas  <- professor[[idLattes]]$orientacoes_academicas  #list
  for( orientacao in names(orientacoes_academicas )) { 
    df_temporario <- cv_tplista2tpchar ( orientacoes_academicas[[orientacao]])
    df_temporario$orientacao <-  orientacao 
    df_temporario$idLattes <-  idLattes
    df_1orientacao <- concatenadf( df_1orientacao , df_temporario  )
  }  
  return(df_1orientacao) 
}

extrai_orientacoes <- function(jsonProfessores) {
  df_saida <- data.frame()
  for( i in 1:length(jsonProfessores)) {
    jsonProfessor <- jsonProfessores[i]
    df_orientacao <- extrai_1orientacao(jsonProfessor)
    if( nrow(df_saida) > 0 ) {
      df_saida <- concatenadf(df_saida , df_orientacao)
    } else {
      df_saida <- df_orientacao
    }
  }
  df_saida <- df_saida %>% filter(!is.na(idLattes))
  return(df_saida)  
}

# Extracao das areas de atuacao dos professores 

extrai_1area_de_atuacao <- function(professor){
  idLattes <- names(professor)
  df_1area <-  professor[[idLattes]]$areas_de_atuacao
  df_1area$idLattes <- idLattes
  return(df_1area)
}

extrai_areas_atuacao <- function(jsonProfessores){
  df_saida <- data.frame()
  for( i in 1:length(jsonProfessores)) {
    jsonProfessor <- jsonProfessores[i]
    df_area_atuacao <- extrai_1area_de_atuacao(jsonProfessor)
    if( nrow(df_saida) > 0 ) {
      df_saida <- concatenadf(df_saida , df_area_atuacao)
    } else {
      df_saida <- df_area_atuacao
    }
  }
  df_saida <- df_saida %>% filter( !is.na(idLattes))
  return(df_saida)   
}
########################### Inicio ###############################
#### Começo da preparação dos dados referente a profile

unb.prof.biomed.json <- read_file("dados-2018-2/engenharia-biomedica/279.profile.json")
unb.prof.biomed.df.capes <- read.csv("dados-2018-2/PesqPosCapes.csv", 
                              sep = ";", header = TRUE, colClasses = "character")
unb.prof.biomed <- fromJSON(unb.prof.biomed.json)
length(unb.prof.biomed)

# extrai perfis dos professores 
unb.prof.biomed.df.professores <- extrai_perfis(unb.prof.biomed)

# extrai producao bibliografica de todos os professores 
unb.prof.biomed.df.publicacoes <- extrai_producoes(unb.prof.biomed)

#extrai orientacoes 
unb.prof.biomed.df.orientacoes <- extrai_orientacoes(unb.prof.biomed)

#extrai areas de atuacao 
unb.prof.biomed.df.areas.de.atuacao <- extrai_areas_atuacao(unb.prof.biomed)

#salva os daframes 
save(unb.prof.biomed.df.professores, unb.prof.biomed.df.publicacoes,
     unb.prof.biomed.df.orientacoes, unb.prof.biomed.df.areas.de.atuacao, file = "dataframes.Rda")

#cria arquivo para análise
unb.prof.biomed.df <- data.frame()
unb.prof.biomed.df <- unb.prof.biomed.df.professores %>% 
  select(idLattes, nome, resumo_cv, senioridade) %>% 
  left_join(
    unb.prof.biomed.df.orientacoes %>% 
      select(orientacao, idLattes) %>% 
      filter(!grepl("EM_ANDAMENTO", orientacao)) %>% 
      group_by(idLattes) %>% 
      count(orientacao) %>% 
      spread(key = orientacao, value = n), 
    by = "idLattes") %>% 
  left_join(
    unb.prof.biomed.df.publicacoes %>% 
      select(tipo_producao, idLattes) %>% 
      filter(!grepl("ARTIGO_ACEITO", tipo_producao)) %>% 
      group_by(idLattes) %>% 
      count(tipo_producao) %>% 
      spread(key = tipo_producao, value = n), 
    by = "idLattes") %>% 
  left_join(
    unb.prof.biomed.df.areas.de.atuacao %>% 
      select(area, idLattes) %>% 
      group_by(idLattes) %>% 
      summarise(n_distinct(area)), 
    by = "idLattes") %>% 
  left_join(
    unb.prof.biomed.df.capes %>% 
      select(AreaPos, idLattes) %>% 
      group_by(idLattes) %>% 
      summarise(n_distinct(AreaPos)), 
    by = "idLattes")

glimpse(unb.prof.biomed.df)
head(unb.prof.biomed.df,3)
## Mostrando dados processados referente ao arquivo 279.publication.json
glimpse(unb.pub.biomed.df)
#Podemos ver que contêm natureza, titulo, periodico , autores .... 
head(unb.pub.biomed.df,3)
## Mostrando dados processados referente ao arquivo 279.advise.json
glimpse(unb.adv.biomed.df)
#Podemos ver que contêm natureza, titulo, autores, ano, nome aluno, orientadores .... 
head(unb.adv.biomed.df,3)
###################### Os arquivos 
###### 279.graph.json - usado para mostrar correlações
#### 279.list.json - Como explicado este arquivo não contem nenhuma informação interessante.


```


##CRISP-DM Fase.Atividade 3.4 - Integração dos dados

Neste presente trabalho, não se viu a necessidade de fazer merge entres os datas frames.

##CRISP-DM Fase.Atividade 3.5 -  Formatação dos dados

As formatações de dados necessária já foram feitas, como por exemplo "orientadores" virou "orie1" e "orie2", fazendo com que cada variável contenha apenas um elemento, e não mais uma lista de orientadores. 

#CRISP-DM Fase 4 - __Modelagem__

Nesta fase, após ter feito limpeza e preparação dos dados, tem-se que se decidir qual ferramenta usar : computacionais, matemáticas ou estátistica. Esta fase, por enquanto, será omitida.

#CRISP-DM Fase 5 - __Avaliação__

Será exposto em forma de gráficos certos dados que se acharam convenientes e interessante.

Aqui visa-se ver as quantidades de publicações feitas por anos na área de engenharia de biomédica. 
```{r}
unb.adv.biomed.df %>%
group_by(ano) %>%
summarise(Quantidade = n()) %>%
ggplot(aes(x = ano, y = Quantidade)) +
geom_bar(position = "stack",stat = "identity", fill = "red")+
geom_text(aes(label=Quantidade), vjust=-0.3, size=2.5)+
theme_minimal()
```

Agora verificando a quantidade separada por tipo de publicação.

```{r}
unb.adv.biomed.df %>%
group_by(natureza) %>%
summarise(Quantidade = n()) %>%
ggplot(aes(x = natureza, y = Quantidade)) +
geom_bar(position = "stack",stat = "identity", fill = "blue")+
geom_text(aes(label=Quantidade), vjust=-0.3, size=2.5)+
theme_minimal()
```

Verificando os cursos mais presentes.

```{r}
cursos_d5
pie(cursos_d5,clockwise=TRUE,main="Cursos mais presentes")

```
Quantos bolsistas tem ?

```{r}
unb.adv.biomed.df %>%
group_by(bolsa) %>%
summarise(Quantidade = n()) %>%
ggplot(aes(x = bolsa, y = Quantidade)) +
geom_bar(position = "stack",stat = "identity", fill = "blue")+
geom_text(aes(label=Quantidade), vjust=-0.3, size=2.5)+
theme_minimal()
```

Assim, estes gráficos permitem verificar alguns aspectos importantes sobre as orientações.

Verificando, agora, o arquivo 279.publication.json, contendo informações sobre as publicações.

```{r}
pie(table(unb.pub.biomed.df$natureza),main="Natureza das publicações",col = "cyan")

```

Separando por ano e depois por periódico.

```{r}
unb.pub.biomed.df %>%
group_by(ano) %>%
summarise(Quantidade = n()) %>%
ggplot(aes(x = ano, y = Quantidade)) +
geom_bar(position = "stack",stat = "identity", fill = "blue")+
geom_text(aes(label=Quantidade), vjust=-0.3, size=2.5)+
theme_minimal()
```

```{r}

d <- table(unb.pub.biomed.df$periodico)
head(sort(d,decreasing = TRUE),n=5)

```

Mostrando os autores que mais participaram de publicações. 

```{r}


head(sort(table(toupper(unlist(strsplit(unb.pub.biomed.df$autores,";")))),decreasing = TRUE),n=10)

```

Assim, vemos que há algumas incoerência neste dado acima, isto se dá pela falta de uniformidade.

Analisando o arquivo 279.profile.json.

```{r}
unb.prof.biomed.df %>%
group_by(senioridade) %>%
summarise(Quantidade = n()) %>%
ggplot(aes(x = senioridade, y = Quantidade)) +
geom_bar(position = "stack",stat = "identity", fill = "green")+
geom_text(aes(label=Quantidade), vjust=-0.3, size=2.5)+
theme_minimal()
```

Analisando quandidade de orientações concluídas no doutorado por professor.

```{r}
unb.prof.biomed.df %>%
group_by(nome) %>%
filter(!is.na(ORIENTACAO_CONCLUIDA_DOUTORADO ))%>%  
ggplot(aes(x = nome, y = ORIENTACAO_CONCLUIDA_DOUTORADO)) +
geom_bar(position = "stack",stat = "identity", fill = "blue")+
geom_text(aes(label=nome), vjust=-0.3, size=2.5)+
theme_minimal()
```

Analisando quandidade de orientações concluídas no mestrado por professor.

```{r}
unb.prof.biomed.df %>%
group_by(nome) %>%
filter(!is.na(ORIENTACAO_CONCLUIDA_MESTRADO ))%>%  
ggplot(aes(x = nome, y = ORIENTACAO_CONCLUIDA_MESTRADO)) +
geom_bar(position = "stack",stat = "identity", fill = "gray")+
geom_text(aes(label=nome), vjust=-0.3, size=2.5)+
theme_minimal()
```

Analisando quandidade de orientações concluídas no pós doutorado por professor.

```{r}
unb.prof.biomed.df %>%
group_by(nome) %>%
filter(!is.na(ORIENTACAO_CONCLUIDA_POS_DOUTORADO))%>%  
ggplot(aes(x = nome, y = ORIENTACAO_CONCLUIDA_POS_DOUTORADO)) +
geom_bar(position = "stack",stat = "identity", fill = "gray")+
geom_text(aes(label=nome), vjust=-0.3, size=2.5)+
theme_minimal()
```

Analisando quandidade de orientações concluídas em outros tipos por professor.

```{r}
unb.prof.biomed.df %>%
group_by(nome) %>%
filter(!is.na(OUTRAS_ORIENTACOES_CONCLUIDAS))%>%  
ggplot(aes(x = nome, y = OUTRAS_ORIENTACOES_CONCLUIDAS)) +
geom_bar(position = "stack",stat = "identity", fill = "gray")+
geom_text(aes(label=nome), vjust=-0.3, size=2.5)+
theme_minimal()
```

Analisando quandidade de eventos ido por professor.

```{r}
unb.prof.biomed.df %>%
group_by(nome) %>%
filter(!is.na(EVENTO))%>%  
ggplot(aes(x = nome, y = EVENTO)) +
geom_bar(position = "stack",stat = "identity", fill = "red")+
geom_text(aes(label=nome), vjust=-0.3, size=2.5)+
theme_minimal()
```

Analisando quandidade de periódicos por professor.

```{r}
unb.prof.biomed.df %>%
group_by(nome) %>%
filter(!is.na(PERIODICO))%>%  
ggplot(aes(x = nome, y = PERIODICO)) +
geom_bar(position = "stack",stat = "identity", fill = "green")+
geom_text(aes(label=nome), vjust=-0.3, size=2.5)+
theme_minimal()
```

Analisando quandidade de livro por professor.

```{r}
unb.prof.biomed.df %>%
group_by(nome) %>%
filter(!is.na(LIVRO))%>%  
ggplot(aes(x = nome, y = LIVRO)) +
geom_bar(position = "stack",stat = "identity", fill = "blue")+
geom_text(aes(label=nome), vjust=-0.3, size=2.5)+
theme_minimal()
```

Analisando quandidade de texto em jornais por professor.

```{r}
unb.prof.biomed.df %>%
group_by(nome) %>%
filter(!is.na(TEXTO_EM_JORNAIS))%>%  
ggplot(aes(x = nome, y = TEXTO_EM_JORNAIS)) +
geom_bar(position = "stack",stat = "identity", fill = "black")+
geom_text(aes(label=nome), vjust=-0.3, size=2.5)+
theme_minimal()
```

Analisando quantidade de professor por major área e posteriormente o área pós-graduação.

```{r}
unb.prof.biomed.df %>%
group_by(`n_distinct(area)`) %>%
summarise(Quantidade = n()) %>%
ggplot(aes(x = `n_distinct(area)`, y = Quantidade)) +
geom_bar(position = "stack",stat = "identity", fill = "green")+
geom_text(aes(label=Quantidade), vjust=-0.3, size=2.5)+
theme_minimal()
```


Analisando quantidade de professor por major área e posteriormente o área pós-graduação.

```{r}
unb.prof.biomed.df %>%
group_by(`n_distinct(AreaPos)`) %>%
summarise(Quantidade = n()) %>%
ggplot(aes(x = `n_distinct(AreaPos)`, y = Quantidade)) +
geom_bar(position = "stack",stat = "identity", fill = "grey")+
geom_text(aes(label=Quantidade), vjust=-0.3, size=2.5)+
theme_minimal()
```



#CRISP-DM Fase 6 - __Implantação__ (_deployment_)
 
 No caso deste presente trabalho, é basicamente os scripts desenvolvido ao decorrer do mesmo.
 
#Conclusão

Ao final deste trabalho, podemos chegar a conclusão que com a "ferramenta" CRISP-DM foi possível realizar uma análise de dados apartir de vários arquivos __JSON__, assim, foi possível perceber como funciona - pelo menos de maneira simplória - a vida de cientista de dados, como se deve preparar os dados, como se deve buscar informações úteis, analisar determinadas informações, plotar gráficos para um efeito mais visual, ver a dificuldade que falta de padronização causa, ainda mais quando se tem os mais diversos arquivos para analisar das mais diversas fontes.

O trabalho usou como base o arquivo disponibilizado pelo professor, no qual continha as explicações de todas as fase do CRISP-DM, seguindo o modelo passado pelo professor, tentou-se ir descorrendo sobre o script em R que se vinha fazendo e correlacionando com alguma fase do CRISP-DM, mas tal divisão não pode ser considerada totalmente fidedigna, haja visto que muitas vezes há mistura de fases e não apenas fases totalmente isoladas, sem influência de outras, procurou-se explicar de maneira simples como se encaixava cada fase.

Por fim, podemos chegar a alguns resultados valorosos ,como por exemplo : as revistas que tem mais publicações advindas da pós-graduação em engenharia biómedica, mas nem tudo são flores, algumas dificuldades vieram em decorrência da falta de uniformidade, porém podemos aprender bastante com este trabalho e nos interar de como começar a fazer análise de dados.

# Referências
